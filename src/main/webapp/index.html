<!DOCTYPE html>
<html lang="pt-br" class="no-js">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" charset="utf-8">
<title>Jetty WebSocket: Chat</title>
<meta name="description" content="HTML5 WebSocket Chat" />
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">

<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
<link type="text/css" rel="stylesheet" href="css/style.css" />
</head>
<body data-spy="scroll" data-target=".navbar-default" data-offset="100">
	<div id="main">
		<div id="chat">
			<div id="menu">
				<input id="username" class="form-control" placeholder="Nome" />
			</div>
	
			<div id="chatbox">
				<div id="messages"></div>
			</div>
	
			<div id="formMessage">
				<input id="message" name="usermsg" type="text" class="form-control" placeholder="Mensagem" />
				<input id="send" class="btn btn-primary" type="button" name="submitmsg" value="Enviar" onclick="sendMessage();" />
			</div>
		</div>
	</div>

	<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>

	<script type="text/javascript">
		var ws;

		$(document).ready(function() {
			var ws_url = "ws://" + document.location.host + "/chat-websocket/webSocketChat";
			ws = new WebSocket(ws_url);

			ws.onopen = function(event) {

			}
			ws.onmessage = function(event) {
				var $messages = $('#messages');
				$messages.html($messages.html() + event.data + "<br/><br/>");
				
				/*$messages.animate({
					scrollTop : ($messages)[0].scrollHeight
				}, "slow");*/
			}
			ws.onclose = function(event) {

			}
		});

		sendMessage = function() {
			if ($('#username').val() != "") {
				var message = $('#username').val() + ": " + $('#message').val();
				ws.send(message);
				$('#message').val('');
			} else {
				alert("O campo Nome deve ser preenchido!");
			}
		}
		
		$("#message").keypress(function(e) {
			if (e.keyCode === 13) {
				sendMessage();
			}
		});
	</script>
</body>
</html>